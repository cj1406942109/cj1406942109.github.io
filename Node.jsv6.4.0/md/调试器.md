# Node.js v6.4.0文档

<!-- toc orderedList:0 -->

- [Node.js v6.4.0文档](#nodejs-v640文档)
- [调试器](#调试器)
	- [观察者](#观察者)
	- [命令参考](#命令参考)
		- [分步](#分步)
		- [断点](#断点)
		- [信息](#信息)
		- [执行控制](#执行控制)
		- [变量](#变量)
	- [高级用法](#高级用法)
	- [Node.js的V8检查器集成](#nodejs的v8检查器集成)

<!-- tocstop -->


# 调试器
> **稳定性：2 - 稳定**

Node.js包含一个进程外的调试工具，可以通过一个基于TCP的协议和内置调试客户端进行使用。要使用它，需要在打开Node.js时，在`debug`参数后跟随要调试的脚本的路径；调试器启动成功会给出成功的提示信息：
```js
$ node debug myscript.js
< debugger listening on port 5858
connecting... ok
break in /home/indutny/Code/git/indutny/myscript.js:1
  1 x = 5;
  2 setTimeout(() => {
  3   debugger;
debug>
```

Node.js的调试器客户端不是一个包含全部特性的调试器，但简单的步骤和检查是可能的。

插入`debugger;`语句到脚本的源码中能在代码中的该位置启用一个断点。

```js
// myscript.js
x = 5;
setTimeout(() => {
  debugger;
  console.log('world');
}, 1000);
console.log('hello');
```

一旦调试器运行，则在第四行会出现一个断点。

```js
$ node debug myscript.js
< debugger listening on port 5858
connecting... ok
break in /home/indutny/Code/git/indutny/myscript.js:1
  1 x = 5;
  2 setTimeout(() => {
  3   debugger;
debug> cont
< hello
break in /home/indutny/Code/git/indutny/myscript.js:3
  1 x = 5;
  2 setTimeout(() => {
  3   debugger;
  4   console.log('world');
  5 }, 1000);
debug> next
break in /home/indutny/Code/git/indutny/myscript.js:4
  2 setTimeout(() => {
  3   debugger;
  4   console.log('world');
  5 }, 1000);
  6 console.log('hello');
debug> repl
Press Ctrl + C to leave debug repl
> x
5
> 2+2
4
debug> next
< world
break in /home/indutny/Code/git/indutny/myscript.js:5
  3   debugger;
  4   console.log('world');
  5 }, 1000);
  6 console.log('hello');
  7
debug> quit
```

`repl`命令允许代码远程执行。`next`命令跳到下一行。输入`help`查看其他可用命令。

不输入命令时，按`enter`会重复之前的调试命令。

## 观察者

调试时可以监听表达式和变量的值。在每一个断点上，每个监听列表中的表达式都会在当前上下文进行计算，并在断点的源码列出来之前立即显示。

## 命令参考

### 分步
- `cont`，`c` - 继续执行
- `next`，`n` - 跳到下一步
- `step`，`s` - 跳入
- `out`，`o` - 跳出
- `pause`，`p` - 暂停运行代码（类似开发者工具中的暂停按钮）

### 断点
- `setBreakpoint()`，`sb()` - 在当前行设置断点
- `setBreakpoint(line)`，`sb(line)` - 在指定行设置断点
- `setBreakpoint('fn()')`，`sb(...)` - 在函数体的第一次声明上设置断点
- `setBreakpoint('script.js', 1)`，`sb(...)` - 在`script.js`的第一行设置断点
- `clearBreakpoint('script.js', 1)`，`cb(...)` - 清除`script.js`的第一行上的断点

也可以在尚未加载的文件或模块上设置断点：
```js
$ node debug test/fixtures/break-in-module/main.js
< debugger listening on port 5858
connecting to port 5858... ok
break in test/fixtures/break-in-module/main.js:1
  1 var mod = require('./mod.js');
  2 mod.hello();
  3 mod.hello();
debug> setBreakpoint('mod.js', 23)
Warning: script 'mod.js' was not loaded yet.
  1 var mod = require('./mod.js');
  2 mod.hello();
  3 mod.hello();
debug> c
break in test/fixtures/break-in-module/mod.js:23
 21
 22 exports.hello = () => {
 23   return 'hello from module';
 24 };
 25
debug>
```

### 信息
- `backtrace`，`bt` - 打印当前执行框架的回溯
- `list` - 显示脚本源码5行上下文（之前和之后5行）
- `watch(expr)` - 添加表达式到监听列表
- `unwatch(expr)` - 从监听列表中移除表达式
- `watchers` - 显示所有的监听者和它们的值（在每个断点自动显示）
- `repl` - 打开调试器的repl，在调试脚本的上下文执行
- `exec expr` - 在调试脚本上下文中执行表达式


### 执行控制
- `run` - 运行脚本（在调试器启动时自动执行）
- `restart` - 重新运行脚本
- `kill` - 杀死脚本

### 变量
- `scripts` - 显示所有加载的脚本
- `version` - 显示V8的版本


## 高级用法

另一种启用调试器的方法是以`--debug`命令标志打开Node.js或者给已经存在的Node.js进程发送`SIGUSR1`信号。

一旦进程以这种方式设置为调试模式，可以通过连接到运行进程的`pid`或者通过`URI`引用到监听调试器来指定使用Node.js调试器：
- `node debug -p <pid>` - 通过`pid`连接到进程
- `node debug <URI>` - 通过`URI`，如：localhost:5858 连接到进程

## Node.js的V8检查器集成

注意：这是一个测试特性。

V8检查器集成允许添加Chrome的开发者工具到Node.js实例，用于调试和性能分析。

V8检查器集成可以在启动Node.js应用时传递`--inspect`标志进行启用。同样可以为该标志提供一个自定义的端口，如：`--inspect=9222`将会接受开发者工具在9222端口进行连接。

要在应用的第一行代码中断，除了`--inspect`还要提供`--debug-brk`标志。

```js
$ node --inspect index.js
Debugger listening on port 9229.
Warning: This is an experimental feature and could change at any time.
To start debugging, open the following URL in Chrome:
    chrome-devtools://devtools/remote/serve_file/@60cd6e859b9f557d2312f5bf532f6aec5f284980/inspector.html?experiments=true&v8only=true&ws=localhost:9229/node
```
