# 列表和键
> 记录时间：2018-10-25

JavaScript中对列表的处理方式：
```js
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map((number) => number * 2);
console.log(doubled);
```

在React中，将数组转换成元素列表的方式几乎相同。

## 渲染多个组件

可以创建元素的集合，并用花括号包括将其放到JSX中。

使用JavaScript的`map()`函数，`numbers`数组进行遍历，对每个值返回一个`<li>`元素：
```js
const numbers = [1, 2, 3, 4, 5];
const listItems = numbers.map((number) =>
  <li>{number}</li>
);
```

将整个`listItems`数组放到`<ul>`元素中，并将其渲染到DOM：
```js
ReactDOM.render(
  <ul>{listItems}</ul>,
  document.getElementById('root')
);
```

## 基础列表组件

很多情况下，你会想要在一个组件内部渲染列表。

我们重构一下之前的例子，得到一个能够接受一个`numbers`数组并输出一个无需的元素列表的组件：
```js
function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) =>
    <li>{number}</li>
  );
  return (
    <ul>{listItems}</ul>
  );
}

const numbers = [1, 2, 3, 4, 5];
ReactDOM.render(
  <NumberList numbers={numbers} />,
  document.getElementById('root')
);
```

直接运行上面的代码会得到一个warning，提示需要给每个列表元素添加一个键。“键”是你在创建元素列表时需要包含的特殊的字符串属性。

对上面的代码稍作调整：
```js
function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) =>
    <li key={number.toString()}>
      {number}
    </li>
  );
  return (
    <ul>{listItems}</ul>
  );
}

const numbers = [1, 2, 3, 4, 5];
ReactDOM.render(
  <NumberList numbers={numbers} />,
  document.getElementById('root')
);
```

## 键

键能够帮助React识别出哪些item发生了改变、或是被添加和删除了。键需要给数组内的元素一个稳定的标识符。
```js
const numbers = [1, 2, 3, 4, 5];
const listItems = numbers.map((number) =>
  <li key={number.toString()}>
    {number}
  </li>
);
```

选择键的最好的方式就是使用一个字符串来唯一标识一个列表item。大多数情况下，你会使用数据的ID作为键：
```js
const todoItems = todos.map((todo) =>
  <li key={todo.id}>
    {todo.text}
  </li>
);
```

如果你没有稳定的ID用于渲染列表，你还可以使用item的index作为键，这是你的最后手段。
```js
const todoItems = todos.map((todo, index) =>
  // Only do this if items have no stable IDs
  <li key={index}>
    {todo.text}
  </li>
);
```

如果item的顺序可能发生改变，那么不推荐使用index作为键。这可能会对性能产生负面影响，也可能会导致组件的状态出现问题。详情查看博客：[in-depth explanation on the negative impacts of using an index as a key](https://medium.com/@robinpokorny/index-as-a-key-is-an-anti-pattern-e0349aece318)。

如果你不给列表item显式地赋值，React默认情况下会使用index作为键。

## 提取带键的组件

键只有在数组上下文中才有意义。

例如，如果你提取一个`ListItem`组件，你应该将键放到数组中的`<ListItem />`元素上，而不是在`ListItem`本身的`<li>`元素上。

错误示例：
```js
function ListItem(props) {
  const value = props.value;
  return (
    // Wrong! There is no need to specify the key here:
    <li key={value.toString()}>
      {value}
    </li>
  );
}

function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) =>
    // Wrong! The key should have been specified here:
    <ListItem value={number} />
  );
  return (
    <ul>
      {listItems}
    </ul>
  );
}

const numbers = [1, 2, 3, 4, 5];
ReactDOM.render(
  <NumberList numbers={numbers} />,
  document.getElementById('root')
);
```

正确示例：
```js
function ListItem(props) {
  // Correct! There is no need to specify the key here:
  return <li>{props.value}</li>;
}

function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) =>
    // Correct! Key should be specified inside the array.
    <ListItem key={number.toString()}
              value={number} />

  );
  return (
    <ul>
      {listItems}
    </ul>
  );
}

const numbers = [1, 2, 3, 4, 5];
ReactDOM.render(
  <NumberList numbers={numbers} />,
  document.getElementById('root')
);
```

一个好的经验法则是，在`map()`调用中的元素需要添加键。

## 键在兄弟元素中必须是唯一的

数组中使用的键在它们的兄弟姐妹之间应该是唯一的。

不过，我们无需保证全局唯一，我们在创建不同的数组时可以使用相同的键。
```js
function Blog(props) {
  const sidebar = (
    <ul>
      {props.posts.map((post) =>
        <li key={post.id}>
          {post.title}
        </li>
      )}
    </ul>
  );
  const content = props.posts.map((post) =>
    <div key={post.id}>
      <h3>{post.title}</h3>
      <p>{post.content}</p>
    </div>
  );
  return (
    <div>
      {sidebar}
      <hr />
      {content}
    </div>
  );
}

const posts = [
  {id: 1, title: 'Hello World', content: 'Welcome to learning React!'},
  {id: 2, title: 'Installation', content: 'You can install React from npm.'}
];
ReactDOM.render(
  <Blog posts={posts} />,
  document.getElementById('root')
);
```

键，作为一个提示工具供React使用，它们不会传递给你的组件。如果在你的组件中需要同样的值，可以将其作为一个属性，使用不同的名字显式地传入。
```js
const content = posts.map((post) =>
  <Post
    key={post.id}
    id={post.id}
    title={post.title} />
);
```

上例中，`Post`组件可以读取到`props.id`，但是读取不到`props.key`。

## 在JSX中嵌入map()

上面的例子都是单独声明`listItems`变量，然后将其包含在JSX中：
```js
function NumberList(props) {
  const numbers = props.numbers;
  const listItems = numbers.map((number) =>
    <ListItem key={number.toString()}
              value={number} />

  );
  return (
    <ul>
      {listItems}
    </ul>
  );
}
```

JSX允许在花括号中嵌入任何表达式，因此我们能够使用`map()`结果的内联形式：
```js
function NumberList(props) {
  const numbers = props.numbers;
  return (
    <ul>
      {numbers.map((number) =>
        <ListItem key={number.toString()}
                  value={number} />

      )}
    </ul>
  );
}
```

有时候这样的写法更清楚，但同样可能会被滥用。就像在JavaScript中一样，是否将其提取为一个变量由你决定。
