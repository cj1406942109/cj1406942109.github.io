# 马尔可夫随机场
> 记录时间：2018-09-02

马尔可夫随机场（Markov random field，MRF）是典型的马尔可夫网（Markov Networ，MN）。是一种著名的概率无向图模型（undirected graphical model）。

如图是一个简单的马尔可夫随机场

![简单的马尔可夫随机场](https://images2015.cnblogs.com/blog/801522/201610/801522-20161011155027461-420207439.png)

## 无向图中的成对马尔可夫性、局部马尔可夫性和全局马尔可夫性

- 成对马尔可夫性：给定所有其他变量，两个非邻接变量条件独立。  
  设$u$和$v$分别是无向图中的任意两个没有边连接的结点，对应的随机变量分别为$X_{u}$和$X_{v}$。其他所有结点集为$O$，对应的随机变量组为$X_{O}$。则：
  $$ P(X_{u},X_{v} \vert X_{O}) = P(X_{u} \vert X_{O})P(X_{v} \vert X_{O})$$
- 局部马尔可夫性：给定某变量的邻接变量，则该变量条件独立于其他变量。  
  设任意结点$v$，对应的随机变量为$X_{v}$。与$v$有边连接的结点集合为$W$，对应的随机变量组为$X_{W}$。$v$和$W$之外的其他结点集合为$O$，对应的随机变量组为$X_{O}$。则：
  $$ P(X_{v},X_{O} \vert X_{W}) = P(X_{v} \vert X_{W})P(X_{O} \vert X_{W})$$
- 全局马尔可夫性：给定两个变量子集的分离集，则这两个变量子集条件独立。  
  设集合$A$和$B$分别为无向图中被结点集$C$分开的任意结点集合，对应的随机变量组分别为$X_{A}, X_{B}, X_{C}$。则：
  $$ P(X_{A},X_{B} \vert X_{C}) = P(X_{A} \vert X_{C})P(X_{B} \vert X_{C}) $$

如果联合概率分布$P(X)$满足成对、局部或全局马尔可夫性，则称其为马尔可夫随机场或概率无向图模型。

## 无向图模型的团与极大团

对于图中结点的一个子集，如果其中任意两个结点间都有边连接，就称这个结点子集为一个“团”。

如果一个团中加入另外任何一个结点都不能再形成团，就称该团为“极大团”，即极大团就是不能被其他团包含的团。

如上图中：$\lbrace x_{1}, x_{2} \rbrace$，$\lbrace x_{1}, x_{3} \rbrace$，$\lbrace x_{2}, x_{4} \rbrace$，$\lbrace x_{2}, x_{5} \rbrace$，$\lbrace x_{2}, x_{6} \rbrace$，$\lbrace x_{3}, x_{5} \rbrace$，$\lbrace x_{5}, x_{6} \rbrace$和$\lbrace x_{2}, x_{5}, x_{6} \rbrace$都是团。
除了$\lbrace x_{2}, x_{5} \rbrace$，$\lbrace x_{2}, x_{6} \rbrace$，$\lbrace x_{5}, x_{6} \rbrace$之外都是极大团。

显然，每个节点至少出现在一个极大团中。

## 概率无向图模型的因子分解

将概率无向图模型的多个变量之间的联合概率分布表示为其最大团上的随机变量的函数乘积形式的操作，称为概率无向图模型的因子分解（factorization）。

具体来说，对于$n$个变量$X = \lbrace x_{1}, x_{2}, ..., x_{n} \rbrace$，所有极大团构成的集合为$C$，与团$Q \in C$对应的变量集合记为$X_{Q}$，则联合概率$P(X)$定义为：
$$ P(X) = \frac1{Z}\prod_{Q \in C}\psi_{Q}(X_{Q})$$
其中$\psi_{Q}$为团$Q$对应的势函数（potential function），用于对团$Q$中的变量关系进行建模，$Z = \sum_x\prod_{Q \in C}\psi_{Q}(X_{Q})$为规范化因子（配分函数），以确保$P(X)$是被正确定义的概率。

如，上图的联合概率分布$P(X)$定义为：
$$ P(X) = \frac1Z\psi_{12}(x_1,x_2)\psi_{13}(x_1,x_3)\psi_{24}(x_2,x_4)\psi_{35}(x_3,x_5)\psi_{256}(x_2,x_5,x_6) $$
$$ Z = \psi_{12}(x_1,x_2)\psi_{13}(x_1,x_3) \\ + \psi_{12}(x_1,x_2)\psi_{24}(x_2,x_4)\psi_{256}(x_2,x_5,x_6) \\ + \psi_{13}(x_1,x_3)\psi_{35}(x_3,x_5) \\ + \psi_{24}(x_2,x_4)  \\ + \psi_{35}(x_3,x_5)\psi_{256}(x_2,x_5,x_6) $$

## 势函数

势函数$\psi_{Q}(X_{Q})$的作用是定量刻画变量集$X_{Q}$中变量之间的相关关系。

它是非负函数，并且在所偏好的变量取值上有较大的函数值，例如，如果势函数为：
$$
\psi_{AC}(x_A, x_C) =
  \begin{cases}
    1.5, & if \ x_A = x_C; \\
    0.1, & otherwise,
  \end{cases}
\\
\psi_{BC}(x_B, x_C) =
  \begin{cases}
    0.2, & if \ x_B = x_C; \\
    1.3, & otherwise,
  \end{cases}
$$
则说明该模型偏好变量$x_A$与$x_C$有相同的取值，$x_B$与$x_C$有不同的取值。

即，在该模型中，$x_A$与$x_C$正相关，$x_B$与$x_C$负相关。

为了满足非负性，通常用指数函数来定义势函数。即：
$$ \psi(X_{Q}) = e^{-H_{Q}(X_{Q})} $$
$H_{Q}(X_{Q})$是一个定义在变量$X_Q$上的实值函数，常见形式为：
$$ H_{Q}(X_{Q}) = \sum_{u,v \in Q, u \ne v} \alpha_{uv}x_{u}x_{v} + \sum_{v \in Q}\beta_{v}x_{v}$$
其中$\alpha_{uv}$和$\beta_{v}$是参数。
